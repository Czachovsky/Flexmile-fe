<div class="dropdown-container" [attr.data-theme]="theme()">
@if(label()){
  <span class="label" [ngClass]="{'disabled': disabled()}">{{label()}}</span>
}
  <button
    type="button"
    class="dropdown-button"
    [class.open]="isOpen()"
    [attr.aria-expanded]="isOpen()"
    [attr.aria-label]="ariaLabel()"
    (click)="toggleDropdown()"
    (keydown.enter)="toggleDropdown()"
    (keydown.escape)="closeDropdown()"
    [disabled]="disabled()">
    <span class="dropdown-label">{{ displayLabel() }}</span>
    <svg
      class="dropdown-arrow"
      [class.rotated]="isOpen()"
      width="16"
      height="16"
      viewBox="0 0 16 16"
      fill="none"
      aria-hidden="true">
      <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </button>

  @if (isOpen()) {
    @if(!hideSearch()){
      <div class="dropdown-search">
        <input
          #searchInput
          type="text"
          placeholder="Szukaj..."
          (input)="searchQuery.set(($any($event.target).value || '').trim())"
          (keydown.escape)="closeDropdown()"
        />
      </div>
    }
    <div class="dropdown-menu" role="listbox">
      @if (showNoResults()) {
        <div class="dropdown-no-results">
          Brak wynik√≥w dla frazy "{{ searchQuery() }}"
        </div>
      } @else {
        @for (option of filteredOptions(); track option.value; let idx = $index) {
          <div
            class="dropdown-item"
            role="option"
            [class.selected]="option.value === selectedValue()"
            [class.focused]="idx === focusedIndex()"
            (click)="selectOption(option)"
            (mouseenter)="setFocusedIndex(idx)">
            {{ option.label }}
          </div>
        }
      }
    </div>
  }
</div>
