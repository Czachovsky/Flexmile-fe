<div class="offer">
  <div class="offer-details-container">
    <div class="container">
      <div class="flex">
        <div class="offer-details-container-l flex-1">
          <div class="gray-bg">
            <div class="offer__id py-4">
              @if (screen.isMobile()) {
                <flexmile-link title="Wróć" url="/oferty" icon="pi-arrow-left"
                               iconPosition="left"></flexmile-link>
              }
              {{ details().car_reference_id }}
            </div>
            <div class="offer__body xlg:pb-7 pb-4">
              <div class="offer__body-info xxl:pr-7">
                <div class="offer__body-info-header">
                  <div
                    class="flex xxxl:align-items-center align-items-start justify-content-between pb-2 xxxl:flex-row flex-column">
                    <h1>{{ details().brand.name }} {{ details().model }}</h1>
                    @if (!screen.isMobile()) {
                      <div class="flex gap-2">
                        @if (details().attributes.new) {
                          <flexmile-badge [type]="badgeTypes.AVAILABLE" [label]="'Nowy samochód!'"
                                          [size]="badgeSizes.LG"></flexmile-badge>
                        }
                        @if (!details().available) {
                          <flexmile-badge [type]="badgeTypes.RESERVED" [size]="badgeSizes.LG"></flexmile-badge>
                        } @else {
                          @if (details().attributes.available_immediately) {
                            <flexmile-badge [type]="badgeTypes.AVAILABLE" [size]="badgeSizes.LG"></flexmile-badge>
                          }
                          @if (details().attributes.coming_soon) {
                            <flexmile-badge [type]="badgeTypes.SOON" [size]="badgeSizes.LG"
                                            [date]="details().coming_soon_date"></flexmile-badge>
                          }
                        }
                      </div>
                    }
                  </div>
                  <span class="block pb-3">
              {{ details().specs.engine }}
            </span>
                  <div class="offer__body-info-header-specs flex align-items-center pb-3">
                    <div>
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path
                          d="M3.71094 0H9.96094C11.3672 0 12.5 1.13281 12.5 2.5V10H13.125C14.8438 10 16.25 11.4062 16.25 13.125V15C16.25 15.7031 16.7969 16.25 17.5 16.25C18.1641 16.25 18.75 15.7031 18.75 15V8.75C17.3438 8.75 16.25 7.65625 16.25 6.25V3.32031L15.1953 2.34375C14.9219 2.10938 14.9219 1.71875 15.1562 1.48438C15.3906 1.21094 15.7812 1.21094 16.0156 1.44531L19.1797 4.29688C19.6875 4.80469 20 5.46875 20 6.17188V15C20 16.4062 18.8672 17.5 17.5 17.5C16.0938 17.5 15 16.4062 15 15V13.125C15 12.1094 14.1406 11.25 13.125 11.25H12.5V18.75H13.125C13.4375 18.75 13.75 19.0625 13.75 19.375C13.75 19.7266 13.4375 20 13.125 20H0.625C0.273438 20 0 19.7266 0 19.375C0 19.0625 0.273438 18.75 0.625 18.75H1.25V2.5C1.25 1.13281 2.34375 0 3.75 0H3.71094ZM9.96094 1.25H3.71094C3.04688 1.25 2.46094 1.83594 2.46094 2.5V7.5H11.25V2.5C11.25 1.83594 10.6641 1.25 9.96094 1.25ZM11.25 8.75H2.46094V18.75H11.25V8.75ZM18.75 7.5V6.17188C18.75 5.82031 18.5938 5.46875 18.3203 5.23438L17.5 4.45312V6.25C17.5 6.95312 18.0469 7.5 18.75 7.5Z"
                          fill="#863087"/>
                      </svg>
                      {{ getFuelLabel(details().fuel_type) }}
                    </div>
                    <div>
                      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none">
                        <path
                          d="M24 3.3C24 1.4625 22.5375 0 20.7 0C18.8625 0 17.4 1.4625 17.4 3.3C17.4 4.8375 18.4875 6.15 19.95 6.4875V11.25H12.75V6.4875C14.2125 6.15 15.3 4.8375 15.3 3.3C15.3 1.4625 13.8 0 12 0C10.2 0 8.7 1.4625 8.7 3.3C8.7 4.8375 9.7875 6.15 11.25 6.4875V11.25H4.05V6.4875C5.5125 6.15 6.6 4.8375 6.6 3.3C6.6 1.5 5.1375 0 3.3 0C1.4625 0 0 1.4625 0 3.3C0 4.8375 1.0875 6.15 2.55 6.4875V17.5125C1.0875 17.85 0 19.1625 0 20.7C0 22.5375 1.4625 24 3.3 24C5.1375 24 6.6 22.5375 6.6 20.7C6.6 19.1625 5.5125 17.85 4.05 17.5125V12.75H11.25V17.5125C9.7875 17.85 8.7 19.1625 8.7 20.7C8.7 22.5 10.1625 24 12 24C13.8375 24 15.3 22.5375 15.3 20.7C15.3 19.1625 14.2125 17.85 12.75 17.5125V12.75H20.7C21.1125 12.75 21.45 12.4125 21.45 12V6.4875C22.9125 6.15 24 4.8375 24 3.3ZM1.5 3.3C1.5 2.2875 2.2875 1.5 3.3 1.5C4.3125 1.5 5.1 2.2875 5.1 3.3C5.1 4.275 4.3125 5.1 3.3 5.1C2.2875 5.1 1.5 4.275 1.5 3.3ZM5.0625 20.7C5.0625 21.675 4.275 22.5 3.2625 22.5C2.25 22.5 1.5 21.7125 1.5 20.7C1.5 19.725 2.2875 18.9 3.3 18.9C4.3125 18.9 5.0625 19.725 5.0625 20.7ZM10.2 3.3C10.2 2.2875 11.025 1.5 12 1.5C12.975 1.5 13.8 2.2875 13.8 3.3C13.8 4.275 13.0125 5.1 12 5.1C10.9875 5.1 10.2 4.275 10.2 3.3ZM13.8 20.7C13.8 21.675 13.0125 22.5 12 22.5C10.9875 22.5 10.2 21.7125 10.2 20.7C10.2 19.725 10.9875 18.9 12 18.9C13.0125 18.9 13.8 19.725 13.8 20.7ZM20.7 5.0625C19.725 5.0625 18.9 4.275 18.9 3.2625C18.9 2.2875 19.6875 1.4625 20.7 1.4625C21.7125 1.4625 22.5 2.2875 22.5 3.3C22.5 4.275 21.7125 5.0625 20.7 5.0625Z"
                          fill="#863087"/>
                      </svg>
                      {{ getTransmissionLabel(details().specs.transmission) }}
                    </div>
                    <div>
                      <svg xmlns="http://www.w3.org/2000/svg" width="25" height="15" viewBox="0 0 25 15" fill="none">
                        <path
                          d="M8.4375 7.5C8.4375 8.04688 8.00781 8.4375 7.5 8.4375C6.95312 8.4375 6.5625 8.04688 6.5625 7.5C6.5625 6.99219 6.95312 6.5625 7.5 6.5625C8.00781 6.5625 8.4375 6.99219 8.4375 7.5ZM10.3125 7.5C10.3125 6.99219 10.7031 6.5625 11.25 6.5625C11.7578 6.5625 12.1875 6.99219 12.1875 7.5C12.1875 8.04688 11.7578 8.4375 11.25 8.4375C10.7031 8.4375 10.3125 8.04688 10.3125 7.5ZM15.9375 7.5C15.9375 8.04688 15.5078 8.4375 15 8.4375C14.4531 8.4375 14.0625 8.04688 14.0625 7.5C14.0625 6.99219 14.4531 6.5625 15 6.5625C15.5078 6.5625 15.9375 6.99219 15.9375 7.5ZM16.25 0.625C16.25 0.976562 15.9375 1.25 15.625 1.25H12.5V2.5H15.4688C15.9766 2.5 16.4453 2.65625 16.875 2.92969L18.8672 4.25781C19.5703 4.72656 20 5.50781 20 6.36719V12.5C20 13.9062 18.8672 15 17.5 15H9.92188C9.17969 15 8.4375 14.6875 7.96875 14.0625L6.71875 12.5H5.625C4.57031 12.5 3.75 11.6797 3.75 10.625V8.125H1.25V11.25C1.25 11.6016 0.9375 11.875 0.625 11.875C0.273438 11.875 0 11.6016 0 11.25V3.75C0 3.4375 0.273438 3.125 0.625 3.125C0.9375 3.125 1.25 3.4375 1.25 3.75V6.875H3.75V4.375C3.75 3.35938 4.57031 2.5 5.625 2.5H11.25V1.25H8.125C7.77344 1.25 7.5 0.976562 7.5 0.625C7.5 0.3125 7.77344 0 8.125 0H15.625C15.9375 0 16.25 0.3125 16.25 0.625ZM5.625 3.75C5.27344 3.75 5 4.0625 5 4.375V10.625C5 10.9766 5.27344 11.25 5.625 11.25H7.34375L8.94531 13.2812C9.17969 13.5938 9.57031 13.75 9.92188 13.75H17.5C18.1641 13.75 18.75 13.2031 18.75 12.5V6.36719C18.75 5.9375 18.5156 5.54688 18.1641 5.3125L16.1719 3.98438C15.9766 3.82812 15.7031 3.75 15.4688 3.75H5.625ZM21.25 6.25C21.25 5.58594 21.7969 5 22.5 5H23.75C24.4141 5 25 5.58594 25 6.25V13.75C25 14.4531 24.4141 15 23.75 15H22.5C21.7969 15 21.25 14.4531 21.25 13.75V6.25ZM22.5 13.75H23.75V6.25H22.5V13.75Z"
                          fill="#863087"/>
                      </svg>
                      {{ details().specs.engine_capacity }} cm³ / {{ details().specs.horsepower }} KM
                    </div>
                  </div>
                  @if (screen.isMobile()) {
                    <div class="flex gap-2">
                      @if (details().attributes.new) {
                        <flexmile-badge [type]="badgeTypes.AVAILABLE" [label]="'Nowy samochód!'"
                                        [size]="badgeSizes.LG"></flexmile-badge>
                      }
                      @if (!details().available) {
                        <flexmile-badge [type]="badgeTypes.RESERVED" [size]="badgeSizes.LG"></flexmile-badge>
                      } @else {
                        @if (details().attributes.available_immediately) {
                          <flexmile-badge [type]="badgeTypes.AVAILABLE" [size]="badgeSizes.LG"></flexmile-badge>
                        }
                        @if (details().attributes.coming_soon) {
                          <flexmile-badge [type]="badgeTypes.SOON" [size]="badgeSizes.LG"
                                          [date]="details().coming_soon_date"></flexmile-badge>
                        }
                      }
                    </div>
                  }
                </div>
                <div class="offer__body-gallery">
                  <flexmile-offer-gallery [gallery]="details().gallery!" [hideControls]="true"
                                          [carBrand]="details().brand.name"
                                          [carModel]="details().model"></flexmile-offer-gallery>
                </div>
              </div>
            </div>
            @if (screen.isLowerThanTablet()) {
              <div class="offer__body-form">
                <div class="header-wrapper pb-3 mb-3">
                  <h3 class="block">Dopasuj najem do Twojej firmy!</h3>
                </div>
                <div class="block">
                  <div>
                    <div class="pb-4">
                      <div class="pb-2">Czas trwania umowy <span>(w miesiącach)</span></div>
                      <div class="periods flex gap-2 flex-wrap">
                        @for (period of details().pricing.rental_periods; track period) {
                          <flexmile-button [btnClass]="isPeriodActive(period) ? 'active' : ''" [label]="period"
                                           color="secondary" size="medium"
                                           (click)="selectPeriod(period)"></flexmile-button>
                        }
                      </div>
                    </div>
                    <div class="pb-4">
                      <div class="pb-2">Roczny limit kilometrów <span>(tys. km)</span></div>
                      <div class="mileage flex gap-2 flex-wrap">
                        @for (limit of details().pricing.mileage_limits; track limit) {
                          <flexmile-button [btnClass]="isMileageLimitActive(limit) ? 'active' : ''"
                                           label="{{(limit / 1000) | number:'1.0-0'}}" color="secondary"
                                           size="medium" (click)="selectMileageLimit(limit)"></flexmile-button>
                        }
                      </div>
                    </div>
                    <div class="pb-4">
                      <div class="pb-2">Opłata początkowa</div>
                      <div class="initial-payment flex gap-2 flex-wrap">
                        @for (initialPayment of details().pricing.initial_payments; track initialPayment) {
                          <flexmile-button label="{{ initialPayment| number:'1.0-0' }} zł" color="secondary"
                                           [btnClass]="isInitialPaymentActive(initialPayment) ? 'active' : ''"
                                           size="medium"
                                           (click)="selectInitialPayment(initialPayment)"></flexmile-button>
                        }
                      </div>
                    </div>
                    <div class="offer__body-form-price">
                      <div class="p">{{ offerService.calculatedPrice | number:'1.0-0' }} PLN
                        <span>/netto mies.</span>
                      </div>
                      <div class="price-info pb-4"
                           [ngClass]="{'opacity-0' : offerService.selectedInitialPayment !== 0}">
                        <b>0 zł</b> wpłaty na start!
                      </div>
                      <div class="b">
                        <flexmile-button [disabled]="!canOrder()" [btnClass]="'w-full'"
                                         [label]="details().attributes.coming_soon ? 'Zarezerwuj' : 'Zamów'"
                                         iconPosition="right"
                                         icon="pi-arrow-right"
                                         size="large" (click)="onOrderClick()"></flexmile-button>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            }
          </div>
          <div>
            <div class="offer--info" #offerInfoSection>
              <div class="offer--info-container pb-7">
                <div class="technicals xlg:pt-7 pt-4 xlg:pb-5 pb-4">
                  <div class="technicals-header">
                    <h3 class="pb-5">Dane techniczne</h3>
                  </div>
                  <div class="technicals-info">
                    @for (spec of technicalsArray; track spec.value) {
                      @if (getSpecValue(spec.value) && getSpecValue(spec.value) !== '' && getSpecValue(spec.value) !== ' ' && getSpecValue(spec.value) !== null) {
                        <div>
              <span class="block">
                @if (spec.value === 'specs.condition' && details().specs.condition !== 'new') {
                  {{ getConditionLabel(details().specs.condition) }}
                } @else {
                  {{ spec.label | nullsafe: null : "" : "bd." }}
                }
              </span>

                          @if (spec.value === 'specs.condition' && details().specs.condition !== 'new') {
                            <b
                              class="block">{{ getSpecValue('specs.mileage')  | number:'1.0-0' | nullsafe: null : "" : "bd." }}
                              km
                            </b>
                          } @else {
                            @if (spec.value === 'specs.transmission') {
                              <b
                                class="block"> {{ getTransmissionLabel(details().specs.transmission) | nullsafe: null : "" : "bd." }}</b>
                            } @else if (spec.value === 'fuel_type') {
                              <b
                                class="block"> {{ getFuelLabel(details().fuel_type) | nullsafe: null : "" : "bd." }}</b>
                            } @else if (spec.value === 'specs.drivetrain') {
                              <b class="block"> {{ details().specs.drivetrain | nullsafe: null : "" : "bd." }}</b>
                            } @else if (spec.value === 'body_type') {
                              <b
                                class="block"> {{ getBodyTypeLabel(details().body_type) | nullsafe: null : "" : "bd." }}</b>
                            } @else if (spec.value === 'specs.condition') {
                              <b
                                class="block"> {{ getConditionLabel(details().specs.condition) | nullsafe: null : "" : "bd." }}</b>
                            } @else {
                              <b
                                class="block">{{ getSpecValue(spec.value) | nullsafe: null : "" : "bd." }}
                                @if (spec.value === 'specs.horsepower') {
                                  KM
                                }
                                @if (spec.value === 'specs.co2_emission') {
                                  g/km
                                }
                              </b>
                            }
                          }
                        </div>
                      }
                    }
                  </div>
                </div>
                @if (details().additional_equipment?.length || details().standard_equipment?.length) {
                  <div class="equipment xlg:py-5 py-4">
                    <div class="equipment-header">
                      <h3 class="xlg:pb-5 pb-4">Wyposażenie</h3>
                    </div>
                    <div class="equipment-list">
                      @if (details().standard_equipment?.length) {
                        <div class="equipment-list--standard mb-5">
                          <div class="mb-4">Standardowe</div>
                          <ul>
                            @for (equipment of details().standard_equipment | slice:0:standardEquipmentDisplayCount; track equipment; let i = $index) {
                              <li>
                                {{ equipment }}
                              </li>
                            }
                          </ul>
                          @if (showStandardEquipmentToggle) {
                            <button type="button" class="equipment-list__toggle" (click)="toggleStandardEquipment()">
                              {{ isShowingAllStandardEquipment ? 'Pokaż mniej' : 'Pokaż więcej' }}
                            </button>
                          }
                        </div>
                      }
                      @if (details().additional_equipment?.length) {
                        <div class="equipment-list--additional">
                          <div class="mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="21" viewBox="0 0 22 21"
                                 fill="none">
                              <path
                                d="M11.9531 0.9375L14.5312 6.13281L20.2344 6.95312C21.25 7.10938 21.6797 8.35938 20.9375 9.10156L16.7969 13.0859L17.7734 18.75C17.9297 19.7656 16.875 20.5469 15.9375 20.0781L10.8594 17.4219L5.74219 20.1172C4.80469 20.5859 3.75 19.8047 3.90625 18.7891L4.88281 13.125L0.742188 9.10156C0 8.35938 0.429688 7.10938 1.44531 6.95312L7.14844 6.13281L9.72656 0.9375C10.1953 0 11.5234 0.0390625 11.9531 0.9375Z"
                                fill="#C1D342"/>
                            </svg>
                            Wyposażenie dodatkowe
                          </div>
                          <ul>
                            @for (equipment of details().additional_equipment; track equipment; let i = $index) {
                              <li>
                                {{ equipment }}
                              </li>
                            }
                          </ul>
                        </div>
                      }
                    </div>
                  </div>
                }
                @if (checkIfAnyTrue() || details().custom_additional_data.length) {
                  <div class="offer--description xlg:pt-5 pt-4 xlg:pb-0 pb-5">
                    <h3 class="pb-5">W racie najmu od flexmile!</h3>
                    @for (description of descriptionList; track description.id) {
                      @if (details().additional_services[description.id].enabled) {
                        <div class="flex offer--description_item xlg:mb-5 mb-3">
                          <div class="offer--description_item-icon">
                            @if (description.icon) {
                              <img src="{{description.icon}}"
                                   alt="{{details().additional_services[description.id].title}}">
                            }
                          </div>
                          <div class="flex flex-column">
                            <h4>{{ details().additional_services[description.id].title }}</h4>
                            <span>{{ details().additional_services[description.id].description }}</span>
                          </div>
                        </div>
                      }
                    }
                    @if (details().custom_additional_data.length) {
                      @for (additionalDescription of details().custom_additional_data; track additionalDescription.title) {
                        <div class="flex offer--description_item xlg:mb-5 mb-3">
                          <div class="offer--description_item-icon">
                            <img src="/layout/images/6.svg" alt="{{additionalDescription.title}}">
                          </div>
                          <div class="flex flex-column">
                            <h4>{{ additionalDescription.title }}</h4>
                            <span>{{ additionalDescription.description }}</span>
                          </div>
                        </div>
                      }
                    }
                  </div>
                }
                <div>
                  <flexmile-banner-list size="small" [icon]="descriptionBanner.icon" label="Odbiór w salonie"
                                        separator="&nbsp;lub&nbsp;"
                                        description=" dostawa pod dom!"></flexmile-banner-list>
                </div>
              </div>
            </div>
          </div>
        </div>
        @if (!screen.isLowerThanTablet()) {
          <div class="offer-details-container-r">
            <div class="offer__body-form">
              <div class="header-wrapper pb-3 mb-3">
                <h3 class="block">Dopasuj najem do Twojej firmy!</h3>
              </div>
              <div class="block">
                <div>
                  <div class="pb-4">
                    <div class="pb-2">Czas trwania umowy <span>(w miesiącach)</span></div>
                    <div class="periods flex gap-2 flex-wrap">
                      @for (period of details().pricing.rental_periods; track period) {
                        <flexmile-button [btnClass]="isPeriodActive(period) ? 'active' : ''" [label]="period"
                                         color="secondary" size="medium"
                                         (click)="selectPeriod(period)"></flexmile-button>
                      }
                    </div>
                  </div>
                  <div class="pb-4">
                    <div class="pb-2">Roczny limit kilometrów <span>(tys. km)</span></div>
                    <div class="mileage flex gap-2 flex-wrap">
                      @for (limit of details().pricing.mileage_limits; track limit) {
                        <flexmile-button [btnClass]="isMileageLimitActive(limit) ? 'active' : ''"
                                         label="{{(limit / 1000) | number:'1.0-0'}}" color="secondary"
                                         size="medium" (click)="selectMileageLimit(limit)"></flexmile-button>
                      }
                    </div>
                  </div>
                  <div class="pb-4">
                    <div class="pb-2">Opłata początkowa</div>
                    <div class="initial-payment flex gap-2 flex-wrap">
                      @for (initialPayment of details().pricing.initial_payments; track initialPayment) {
                        <flexmile-button label="{{ initialPayment| number:'1.0-0' }} zł" color="secondary"
                                         [btnClass]="isInitialPaymentActive(initialPayment) ? 'active' : ''"
                                         size="medium" (click)="selectInitialPayment(initialPayment)"></flexmile-button>
                      }
                    </div>
                  </div>
                  <div class="offer__body-form-price">
                    <div class="p">{{ offerService.calculatedPrice | number:'1.0-0' }} PLN
                      <span>/netto mies.</span>
                    </div>
                    <div class="price-info pb-4"
                         [ngClass]="{'opacity-0' : offerService.selectedInitialPayment !== 0}">
                      <b>0 zł</b> wpłaty na start!
                    </div>
                    <div class="b">
                      <flexmile-button [disabled]="!canOrder()" [btnClass]="'w-full'"
                                       [label]="details().attributes.coming_soon ? 'Zarezerwuj' : 'Zamów'"
                                       iconPosition="right"
                                       icon="pi-arrow-right"
                                       size="large" (click)="onOrderClick()"></flexmile-button>
                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>
        }
      </div>
      @if (similarOffers().length) {
        <div class="similar-offers">
          <flexmile-offers-carousel [similarOffers]="similarOffers()"></flexmile-offers-carousel>
        </div>
      }
    </div>
  </div>
</div>

@if (screen.isMobile() && isOfferInfoAtTop) {
  <div class="mobile-button-wrapper p-4" @slideUpDown>
    <flexmile-button [disabled]="!canOrder()" [btnClass]="'w-full'"
                     [label]="details().attributes.coming_soon ? 'Zarezerwuj' : 'Zamów'"
                     iconPosition="right"
                     icon="pi-arrow-right"
                     size="large" (click)="onOrderClick()"></flexmile-button>
  </div>
}


