<div class="offer-order">
  @if (ordering) {
    <div class="__loading">
      <flexmile-loader></flexmile-loader>
    </div>
  }
  <div class="go-back px-7 py-5 hidden xl:flex">
    <span (click)="backToDetails()"><i class="pi pi-arrow-left"></i> Wróć</span>
  </div>
  <div class="container" [formGroup]="orderForm">
    <div class="go-back py-5 flex xl:hidden">
      <span (click)="backToDetails()"><i class="pi pi-arrow-left"></i> Wróć</span>
    </div>
    <div class="grid justify-content-around">
      <div class="xl:col-6 col-12 xl:pr-6 offer-order_left">
        <div>
          <div class="xl:hidden block mobile_title pb-2">{{ details().brand.name }} {{ details().model }}</div>
          <h2 class="pb-3">
            @if (details().attributes.coming_soon) {
              Zarezerwuj
            } @else {
              Złóż zamówienie
            }
          </h2>
          <span>
            Jesteś o krok od nowego samochodu!
            Wypełnij formularz, nasz doradca potwierdzi dostępność wybranego auta i ustali z Tobą szczegóły wynajmu oraz odbioru.
            <br>Złożenie @if (details().attributes.coming_soon) {rezerwacji} @else{zamówienia} jest bezpłatne i nie oznacza jeszcze zawarcia umowy.
            </span>
          <div class="offer-order-details">
            <div class="offer-order-details_section">
              <h4 class="mb-4 xl:mb-5">Szczegóły zamówienia</h4>
              <div>
                <span>Czas trwania umowy <span> (w miesiącach)</span></span>
                <div class="periods flex gap-2 flex-wrap pb-5">
                  @for (period of details().pricing.rental_periods; track period) {
                    <flexmile-button [btnClass]="isPeriodActive(period) ? 'active' : ''" [label]="period"
                                     color="secondary" size="medium" (click)="selectPeriod(period)"></flexmile-button>
                  }
                </div>
              </div>
              <div>
                <span>Roczny limit kilometrów <span> (tys. km)</span></span>
                <div class="mileage flex gap-2 flex-wrap pb-5">
                  @for (limit of details().pricing.mileage_limits; track limit) {
                    <flexmile-button [btnClass]="isMileageLimitActive(limit) ? 'active' : ''"
                                     label="{{(limit / 1000) | number:'1.0-0'}}" color="secondary"
                                     size="medium" (click)="selectMileageLimit(limit)"></flexmile-button>
                  }
                </div>
              </div>
              <div>
                <span>Opłata początkowa</span>
                <div class="mileage flex gap-2 flex-wrap pb-5">
                  @for (initialPayment of details().pricing.initial_payments; track initialPayment) {
                    <flexmile-button label="{{ initialPayment| number:'1.0-0' }} zł" color="secondary"
                                     [btnClass]="isInitialPaymentActive(initialPayment) ? 'active' : ''"
                                     size="medium" (click)="selectInitialPayment(initialPayment)"></flexmile-button>
                  }
                </div>
              </div>
              <div>
                <span class="flex align-items-center gap-2">Preferowane miejsce odbioru <flexmile-tooltip
                  [config]="{text: 'Pytanie ma charakter informacyjny. Decyzję można zmienić w kolejnych etapach', position: 'top', multiline: true}"> <svg
                  xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                  viewBox="0 0 16 16" fill="none">
<path
  d="M8 0C12.4062 0 16 3.59375 16 8C16 12.4375 12.4062 16 8 16C3.5625 16 0 12.4375 0 8C0 3.59375 3.5625 0 8 0ZM8 14.5C11.5625 14.5 14.5 11.5938 14.5 8C14.5 4.4375 11.5625 1.5 8 1.5C4.40625 1.5 1.5 4.4375 1.5 8C1.5 11.5938 4.40625 14.5 8 14.5ZM9.25 10.5C9.65625 10.5 10 10.8438 10 11.25C10 11.6875 9.65625 12 9.25 12H6.75C6.3125 12 6 11.6875 6 11.25C6 10.8438 6.3125 10.5 6.75 10.5H7.25V8.5H7C6.5625 8.5 6.25 8.1875 6.25 7.75C6.25 7.34375 6.5625 7 7 7H8C8.40625 7 8.75 7.34375 8.75 7.75V10.5H9.25ZM8 6C7.4375 6 7 5.5625 7 5C7 4.46875 7.4375 4 8 4C8.53125 4 9 4.46875 9 5C9 5.5625 8.53125 6 8 6Z"
  fill="#863087"/>
                </svg></flexmile-tooltip></span>
                <div class="radios">
                  <label class="flex align-items-center justify-content-start gap-2 pb-2">
                    <input type="radio" formControlName="pickup_location" [value]="pickupLocation.salon"/>
                    Odbiór w salonie
                  </label>
                  <label class="flex align-items-center justify-content-start gap-2">
                    <input type="radio" formControlName="pickup_location" [value]="pickupLocation.home_delivery"/>
                    Darmowa dostawa pod dom
                  </label>
                </div>
              </div>
            </div>
            <div class="offer-order-details_section pb-4">
              <h4 class="mb-5">Dane firmy</h4>
              <div class="grid">
                <div class="xlg:col-6 col-12 order-input">
                  <flexmile-input [classList]="'w-full'" label="Nazwa firmy" placeholder="Wpisz nazwę firmy"
                                  [control]="orderForm.get('company_name')"
                                  inputId="company_name"></flexmile-input>
                </div>
                <div class="xlg:col-6 col-12 order-input">
                  <flexmile-input [classList]="'w-full'" label="NIP" placeholder="Wpisz NIP"
                                  [control]="orderForm.get('tax_id')"
                                  inputId="tax_id"></flexmile-input>
                </div>
                <div class="xlg:col-6 col-12 order-input">
                  <flexmile-input [classList]="'w-full'" label="Email" placeholder="Wpisz Email"
                                  [control]="orderForm.get('email')"
                                  inputId="email"></flexmile-input>
                </div>
                <div class="xlg:col-6 col-12 order-input">
                  <flexmile-input [classList]="'w-full'" label="Telefon" placeholder="Wpisz Telefon"
                                  [control]="orderForm.get('phone')"
                                  inputId="phone"></flexmile-input>
                </div>
              </div>
            </div>
            @if (screen.screenSize() > 1024) {
              <ng-container *ngTemplateOutlet="banners"></ng-container>
            }
          </div>
        </div>
      </div>
      <div class="offer-order_right">
        <div class="p-4">
          @if (details().attributes.available_immediately || details().attributes.coming_soon) {
            <div class="right_label mb-4" [ngClass]="{'soon' : details().attributes.coming_soon}">
              @if (details().attributes.available_immediately) {
                <div>
                  <div>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                      <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M17.6266 2.75726C16.5814 2.41516 15.1579 2.40004 12 2.40004C10.3062 2.40004 9.09591 2.40069 8.14215 2.46577C7.19916 2.5301 6.59487 2.65339 6.10388 2.85676C4.63372 3.46573 3.46568 4.63377 2.85671 6.10393C2.65334 6.59492 2.53006 7.19921 2.46572 8.14219C2.40064 9.09596 2.39999 10.3062 2.39999 12C2.39999 13.6938 2.40064 14.9041 2.46572 15.8579C2.53006 16.8009 2.65334 17.4052 2.85671 17.8961C3.46568 19.3663 4.63372 20.5343 6.10388 21.1433C6.59487 21.3467 7.19916 21.4699 8.14215 21.5342C9.09591 21.5994 10.3062 21.6 12 21.6C13.6938 21.6 14.9041 21.5994 15.8578 21.5342C16.8008 21.4699 17.4051 21.3467 17.896 21.1433C19.3663 20.5343 20.5342 19.3663 21.1432 17.8961C21.3466 17.4052 21.4699 16.8009 21.5342 15.8579C21.5994 14.9041 21.6 13.6938 21.6 12C21.6 11.0811 21.6 10.3006 21.5889 9.61935C21.5782 8.9567 22.1068 8.41086 22.7695 8.40019C23.4321 8.38951 23.978 8.91805 23.9887 9.5807C23.9999 10.2833 23.9999 11.0824 23.9999 11.9923V12.0442C23.9999 13.6842 23.9999 14.9761 23.9287 16.0212C23.8559 17.0865 23.7052 17.9824 23.3606 18.8146C22.508 20.8728 20.8728 22.508 18.8145 23.3606C17.9823 23.7053 17.0864 23.856 16.0212 23.9287C14.9761 24 13.6842 24 12.0443 24H11.9557C10.3158 24 9.02381 24 7.97878 23.9287C6.91359 23.856 6.01761 23.7053 5.18545 23.3606C3.12722 22.508 1.49196 20.8728 0.639407 18.8146C0.294719 17.9824 0.143964 17.0865 0.071292 16.0212C-1.18866e-05 14.9761 0 13.6842 0 12.0442V11.9559C0 10.3158 -1.18866e-05 9.02385 0.071292 7.97882C0.143964 6.91364 0.294719 6.01765 0.639407 5.18549C1.49196 3.12727 3.12722 1.49201 5.18545 0.639456C6.01761 0.294757 6.91359 0.144013 7.97877 0.0713416C9.02381 3.77252e-05 10.3158 3.76109e-05 11.9558 4.96109e-05H12C12.0869 4.96109e-05 12.1729 3.75783e-05 12.258 2.55783e-05C15.0775 -0.000406421 16.9158 -0.00068246 18.3733 0.476341C19.003 0.682488 19.3466 1.36021 19.1404 1.99008C18.9343 2.61993 18.2565 2.96342 17.6266 2.75726Z"
                            fill="white"/>
                      <path
                        d="M23.4053 5.23663C23.9778 4.90269 24.1712 4.16792 23.8372 3.59545C23.5032 3.02299 22.7685 2.82964 22.1961 3.16357L21.9301 3.31872C17.686 5.79438 14.1911 9.35556 11.7966 13.6228L8.13596 9.96609C7.66709 9.49767 6.90728 9.49808 6.43891 9.96693C5.97053 10.4359 5.97094 11.1956 6.43981 11.664L11.256 16.475C11.5308 16.7496 11.9214 16.874 12.3043 16.8092C12.6872 16.7444 13.015 16.4983 13.1842 16.1487C15.3596 11.6533 18.8255 7.90819 23.1394 5.39179L23.4053 5.23663Z"
                        fill="#C1D342"/>
                    </svg>
                  </div>
                  <div class="flex flex-column">
                    <b>DOSTĘPNY OD RĘKI!</b>
                    <span>Do kilku dni od podpisania umowy</span>
                  </div>
                </div>
              } @else {
                <div>
                  <div>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                      <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M17.6266 2.75726C16.5814 2.41516 15.1579 2.40004 12 2.40004C10.3062 2.40004 9.09591 2.40069 8.14215 2.46577C7.19916 2.5301 6.59487 2.65339 6.10388 2.85676C4.63372 3.46573 3.46568 4.63377 2.85671 6.10393C2.65334 6.59492 2.53006 7.19921 2.46572 8.14219C2.40064 9.09596 2.39999 10.3062 2.39999 12C2.39999 13.6938 2.40064 14.9041 2.46572 15.8579C2.53006 16.8009 2.65334 17.4052 2.85671 17.8961C3.46568 19.3663 4.63372 20.5343 6.10388 21.1433C6.59487 21.3467 7.19916 21.4699 8.14215 21.5342C9.09591 21.5994 10.3062 21.6 12 21.6C13.6938 21.6 14.9041 21.5994 15.8578 21.5342C16.8008 21.4699 17.4051 21.3467 17.896 21.1433C19.3663 20.5343 20.5342 19.3663 21.1432 17.8961C21.3466 17.4052 21.4699 16.8009 21.5342 15.8579C21.5994 14.9041 21.6 13.6938 21.6 12C21.6 11.0811 21.6 10.3006 21.5889 9.61935C21.5782 8.9567 22.1068 8.41086 22.7695 8.40019C23.4321 8.38951 23.978 8.91805 23.9887 9.5807C23.9999 10.2833 23.9999 11.0824 23.9999 11.9923V12.0442C23.9999 13.6842 23.9999 14.9761 23.9287 16.0212C23.8559 17.0865 23.7052 17.9824 23.3606 18.8146C22.508 20.8728 20.8728 22.508 18.8145 23.3606C17.9823 23.7053 17.0864 23.856 16.0212 23.9287C14.9761 24 13.6842 24 12.0443 24H11.9557C10.3158 24 9.02381 24 7.97878 23.9287C6.91359 23.856 6.01761 23.7053 5.18545 23.3606C3.12722 22.508 1.49196 20.8728 0.639407 18.8146C0.294719 17.9824 0.143964 17.0865 0.071292 16.0212C-1.18866e-05 14.9761 0 13.6842 0 12.0442V11.9559C0 10.3158 -1.18866e-05 9.02385 0.071292 7.97882C0.143964 6.91364 0.294719 6.01765 0.639407 5.18549C1.49196 3.12727 3.12722 1.49201 5.18545 0.639456C6.01761 0.294757 6.91359 0.144013 7.97877 0.0713416C9.02381 3.77252e-05 10.3158 3.76109e-05 11.9558 4.96109e-05H12C12.0869 4.96109e-05 12.1729 3.75783e-05 12.258 2.55783e-05C15.0775 -0.000406421 16.9158 -0.00068246 18.3733 0.476341C19.003 0.682488 19.3466 1.36021 19.1404 1.99008C18.9343 2.61993 18.2565 2.96342 17.6266 2.75726Z"
                            fill="#525252"/>
                      <path
                        d="M23.4053 5.23672C23.9778 4.90278 24.1712 4.16801 23.8372 3.59554C23.5032 3.02308 22.7685 2.82973 22.1961 3.16366L21.9301 3.31881C17.686 5.79448 14.1911 9.35565 11.7966 13.6229L8.13596 9.96618C7.66709 9.49776 6.90728 9.49817 6.43891 9.96702C5.97053 10.436 5.97094 11.1957 6.43981 11.6641L11.256 16.4751C11.5308 16.7496 11.9214 16.8741 12.3043 16.8093C12.6872 16.7445 13.015 16.4984 13.1842 16.1488C15.3596 11.6534 18.8255 7.90828 23.1394 5.39188L23.4053 5.23672Z"
                        fill="#525252"/>
                    </svg>
                  </div>
                  <div class="flex flex-column">
                    <b>DOSTĘPNY WKRÓTCE</b>
                    <span>{{ details().coming_soon_date }}</span>
                  </div>
                </div>
              }

            </div>
          }
          <div class="right_id pb-2">
            {{ details().car_reference_id }}
          </div>
          <div class="pb-4 flex justify-content-start align-items-end">
            <div class="right_img mr-4">
              @if (details().gallery.length) {
                <img src="{{details().gallery[0].large}}" alt="{{ details().brand.name }} {{ details().model }}">
              } @else {
                <img src="/layout/images/no-image.png" alt="{{ details().brand.name }} {{ details().model }}">
              }
            </div>
            <div>
              <div class="right_title pb-1">
                {{ details().brand.name }} {{ details().model }}
              </div>
              <div class="right_subtitle">
                {{ details().specs.engine ? details().specs.engine + ', ' : '' }}{{ details().specs.engine_capacity }} cm³
              </div>
            </div>
          </div>
          <div class="right_price pb-4">
            {{ offerService.calculatedPrice | number:'1.0-0' }} PLN <span>/netto mies.</span>
          </div>
          <div class="right_consents pb-4">
            <div class="pb-2">
              <flexmile-input
                label="Wyrażam zgodę na otrzymywanie na wskazany adres e-mail wiadomości dotyczących mojego zapytania od flexmile."
                [type]="inputType.checkbox" inputId="consent_email"
                [control]="orderForm.get('consent_email')"></flexmile-input>
            </div>
            <div>
              <flexmile-input
                label="Wyrażam zgodę na kontakt telefoniczny w celu przekazywania informacji handlowych przez flexmile."
                [type]="inputType.checkbox" inputId="consent_phone"
                [control]="orderForm.get('consent_phone')"></flexmile-input>
            </div>
          </div>
          <flexmile-button [disabled]="!canOrder()" [btnClass]="'w-full'"
                           [label]="details().attributes.coming_soon ? 'Zarezerwuj' : 'Zamów'" iconPosition="right"
                           icon="pi-arrow-right"
                           size="large" (clicked)="orderCar()"></flexmile-button>
        </div>
        @if (screen.screenSize() <= 1023) {
          <div class="p-4">
            <ng-container *ngTemplateOutlet="banners"></ng-container>
          </div>
        }
      </div>

    </div>
  </div>
</div>

<ng-template #modalContent>
  <div class="order-modal">
    <div class="model pb-2">{{ details().brand.name }} {{ details().model }}</div>
    <div class="title pb-3">Auto {{ details().attributes.coming_soon ? "zarezerwowane" : "zamówione" }} !</div>
    <span class="block pb-4">Oczekuj na kontakt od flexmile – nasz zespół skontaktuje się z Tobą w ciągu 24 godzin. Jesteś już o krok od nowego samochodu!</span>
    <div>
      <flexmile-button label="Tak jest!" [btnClass]="'w-full'" (clicked)="closeModal()"></flexmile-button>
    </div>
  </div>
</ng-template>

<flexmile-modal [isOpen]="ordered" [hideCloseButton]="true" [content]="modalContent"></flexmile-modal>


<ng-template #banners>
  <div class="offer-order-banners">
    <div class="pb-3">
      <ng-template #banner1>Interesuje Cię <span style="color: #C1D342;">większa liczba</span><br>samochodów
        dla Twojej firmy?
      </ng-template>
      <flexmile-banner-list size="small" [icon]="descriptionBanner.icon"
                            [bannerTemplate]="banner1"></flexmile-banner-list>
    </div>
    <div>
      <ng-template #banner2>Wybierz <span style="color: #C1D342;">kolejny samochód</span> z naszej<br>oferty i
        złóż zamówienie!
      </ng-template>
      <flexmile-banner-list size="small" [icon]="descriptionBanner.icon"
                            [bannerTemplate]="banner2"></flexmile-banner-list>
    </div>
  </div>
</ng-template>
